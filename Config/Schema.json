{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$comment": "$id tag not required yet",
  "title": "Smart Harvest SE",
  "type": "object",
  "properties": {
    "collections": {
      "type": "array",
      "minItems": 0,
      "maxItems": 128,
      "items": { "$ref": "#/definitions/collectionType" }
    }
  },
  "definitions": {
    "operatorType": {
      "type": "string",
      "$comment": "TODO do we need a NOT operator?",
      "enum": [ "AND", "OR" ]
    },

    "signatureType": {
      "type": "string",
      "enum": [ "ALCH", "BOOK", "ARMO", "INGR", "KEYM", "MISC", "SLGM", "WEAP" ]
    },

    "lootCategoryType": {
      "$comment": "restricted to deterministic loot categories",
      "type": "string",
      "enum": [ "book", "clutter", "critter", "drink", "food", "ingredient", "key", "skillbook", "spellbook" ]
    },

    "conditionsType": {
      "type": "object",
      "$comment": "we need 'signatures' or 'lootCategories' in a leaf node as they are highly restrictive, or 'subFilters' which defers the decision",
      "oneOf": [
        {
          "required": [ "signatures" ]
        },
        {
          "required": [ "lootCategories" ]
        },
        {
          "required": [ "subFilters" ]
        }
      ],
      "properties": {
        "plugin": {
          "type": "string",
          "description": "Filename of mod plugin that defines Collection member Forms"
        },
        "keywords": {
          "type": "array",
          "minItems": 1,
          "maxItems": 16,
          "uniqueItems": true,
          "items": { "type": "string" },
          "description": "TESV Object must have KWDA that contains KYWD with EditorID from this list"
        },
        "signatures": {
          "type": "array",
          "minItems": 1,
          "maxItems": 16,
          "uniqueItems": true,
          "items": { "$ref": "#/definitions/signatureType" },
          "description": "TESV Object must have RecordHeader.Signature in this list"
        },
        "lootCategories": {
          "type": "array",
          "minItems": 1,
          "maxItems": 16,
          "uniqueItems": true,
          "items": { "$ref": "#/definitions/lootCategoryType" },
          "description": "TESV Object must have RecordHeader.Signature in this list"
        },
        "subFilters": {
          "type": "array",
          "minItems": 1,
          "maxItems": 5,
          "items": { "$ref": "#/definitions/filterType" },
          "description": "Nested filters must also match"
        }
      }
    },

    "filterType": {
      "type": "object",
      "required": [ "operator", "conditions" ],
      "properties": {
        "operator": { "$ref": "#/definitions/operatorType" },
        "conditions": { "$ref": "#/definitions/conditionsType" }
      }
    },

    "collectionType": {
      "type": "object",
      "required": [ "name", "description", "rootFilter" ],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the collection for in-game display"
        },
        "description": {
          "type": "string",
          "description": "Descriptive test for in-game display"
        },
        "rootFilter": { "$ref": "#/definitions/filterType" }
      }
    }
  }
}
